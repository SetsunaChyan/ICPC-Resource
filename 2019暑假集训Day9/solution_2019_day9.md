### G. 

普通平衡术。

双倍经验: https://www.luogu.org/problem/P3369

标程写的 $Treap$ ，⑧会的同学可以百度一下。



### H. 

双倍经验: https://www.luogu.org/problem/P2766

首先你可以暴力 $dp$ 出原串的最长不下降子序列，然后大力最大流。

不会网络流的同学可以看看模板题 https://www.luogu.org/problem/P3376

考虑如下的建图方式：

首先，我们要保证每个元素只能被选择一次。经典拆点，把每个元素拆成两个点。对于 $V_i$ ，所有的入边连向 $V_{{in}_i}$ ，所有出边从 $V_{{out}_i}$ 流出，然后从 $V_{{in}_i}$ 往 $V_{{out}_i}$ 连一条容量为 $1$ 的边。

其次，我们要让每一条从源点到汇点的路径长度都恰好为 $s$ 。

对于所有 $dp[i]==1$ 的元素，源点向 $V_{{in}_i}$ 连一条非零边。

对于所有 $dp[i]==s$ 的元素，$V_{{out}_i}$ 向汇点连一条非零边。

对于第 $i$ 个元素 $a_i$ ，枚举元素 $j>i$ ，如果 $a_i \leq a_j,dp[i]+1==dp[j]$ ，那么它是可以成为答案候补且不会破坏路径长度的，让 $V_{{out}_i}$ 向 $V_{{in}_j}$ 连一条非零边。

然后这张图的最大流就是答案啦。

